<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="spr.com.hallyu.admin.mapper.MemberMapper">

<!-- 전체 카테고리 목록 (트리 평면 구조) -->
  <select id="memberList" resultType="map">
    <![CDATA[
      SELECT ID, user_id AS USERNAME, PASSWORD, NAME, ROLE, CREATED_AT FROM users
       ORDER BY ROLE ASC;
    ]]>
  </select>
  
   <!-- 1. 특정 사용자의 메뉴 권한 코드 목록 조회 -->
    <select id="findMenuPermissions" parameterType="string" resultType="string">
        SELECT category_code
        FROM user_menu_permission
        WHERE user_id = #{userId}
    </select>

    <!-- 2. 특정 사용자의 모든 메뉴 권한 삭제 -->
    <delete id="deleteMenuPermissions" parameterType="string">
        DELETE FROM user_menu_permission WHERE user_id = #{userId}
    </delete>

    <!-- 3. 특정 사용자에게 여러 메뉴 권한을 한 번에 추가 -->
    <insert id="insertMenuPermissions" parameterType="map">
        INSERT INTO user_menu_permission (user_id, category_code)
        VALUES
        <foreach collection="categoryCodes" item="categoryCode" separator=",">
            (#{userId}, #{categoryCode})
        </foreach>
    </insert>

  

</mapper>
