<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="spr.com.hallyu.admin.mapper.AdminBoardMapper">

    <!-- 특정 카테고리의 게시글 목록 조회 (페이징 적용) -->
    <select id="findPostsByCategory" parameterType="map" resultType="spr.com.hallyu.admin.model.AdminBoardPost">
        SELECT
            id,
            title,
            writer_id AS writerId,
            created_at AS createdAt,
            view_cnt AS viewCount,
            category_code AS categoryCode
        FROM
            board_post
        WHERE
            category_code = #{categoryCode}
        ORDER BY
            id DESC
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- 특정 카테고리의 전체 게시글 수 조회 -->
    <select id="countPostsByCategory" parameterType="string" resultType="int">
        SELECT COUNT(*)
        FROM board_post
        WHERE category_code = #{categoryCode}
    </select>
    
    <select id="findOne" parameterType="long" resultType="spr.com.hallyu.admin.model.AdminBoardPost">
        SELECT
            id, title, content, writer_id AS writerId, created_at AS createdAt,
            view_cnt AS viewCount, category_code AS categoryCode
        FROM board_post
        WHERE id = #{id}
    </select>
    
    <insert id="insertPost" parameterType="spr.com.hallyu.admin.model.AdminBoardPost" useGeneratedKeys="true" keyProperty="id">
    	INSERT INTO board_post (category_code, title, content, writer_id, is_notice, view_cnt, created_at)
    	VALUES (#{categoryCode}, #{title}, #{content}, #{writerId}, false, 0, NOW())
    </insert>

    <update id="updatePost" parameterType="spr.com.hallyu.admin.model.AdminBoardPost">
        UPDATE board_post
        SET title = #{title},
            content = #{content}
        WHERE id = #{id}
    </update>
    
    <delete id="deletePost" parameterType="spr.com.hallyu.admin.model.AdminBoardPost">
        DELETE from board_post
        WHERE category_code = #{categoryCode}
         and id = #{id}
    </delete>
    
    

    <update id="increaseViewCount" parameterType="long">
        UPDATE board_post SET view_cnt = view_cnt + 1 WHERE id = #{id}
    </update>

</mapper>
