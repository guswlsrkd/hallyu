<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="spr.com.hallyu.file.mapper.AttachmentMapper">

    <!-- 파일 정보 저장 (Batch Insert) -->
    <insert id="insertAttachments" parameterType="java.util.List">
       INSERT INTO ATTACHMENT (post_id, category_code, original_filename, stored_filename, file_path, file_size, created_at)
        VALUES
        <foreach collection="attachments" item="file" separator=",">
            (
                #{file.postId},
                #{file.categoryCode},
                #{file.originalFilename},
                #{file.storedFilename},
                #{file.filePath},
                #{file.fileSize},
                NOW()
            )
        </foreach>
    </insert>

    <!-- 게시글 ID로 첨부파일 목록 조회 -->
    <select id="findByPostId" parameterType="long" resultType="spr.com.hallyu.file.model.Attachment">
        SELECT id, post_id, category_code, original_filename, stored_filename, file_path, file_size, created_at
        FROM ATTACHMENT
        WHERE post_id = #{postId}
        ORDER BY id ASC
    </select>
    
    <!-- 파일 ID로 첨부파일 단건 조회 -->
    <select id="findById" parameterType="long" resultType="spr.com.hallyu.file.model.Attachment">
        SELECT id, post_id, category_code, original_filename, stored_filename, file_path, file_size, created_at
        FROM ATTACHMENT
        WHERE id = #{id}
    </select>
    
    <!-- ID 목록으로 첨부파일 목록 조회 -->
    <select id="findByIds" parameterType="java.util.List" resultType="spr.com.hallyu.file.model.Attachment">
        SELECT id, post_id, category_code, original_filename, stored_filename, file_path, file_size, created_at
        FROM ATTACHMENT
        WHERE id IN
        <foreach collection="ids" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </select>

    <!-- ID 목록으로 첨부파일 삭제 (Batch Delete) -->
    <delete id="deleteAttachments" parameterType="java.util.List">
        DELETE FROM ATTACHMENT WHERE id IN
        <foreach collection="ids" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

</mapper>