<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="spr.com.hallyu.board.mapper.BoardMapper">

  <resultMap id="BoardMap" type="spr.com.hallyu.board.model.BoardPost">
    <id property="id" column="id"/>
    <result property="code" column="code"/>
    <result property="title" column="title"/>
    <result property="content" column="content"/>
    <result property="writer" column="writer"/>
    <result property="views" column="views"/>
    <result property="isNotice" column="is_notice"/>
    <result property="createdAt" column="created_at"/>
    <result property="updatedAt" column="updated_at"/>
  </resultMap>

  <select id="countByCode" resultType="long">
    SELECT COUNT(*) FROM board_post WHERE code = #{code}
  </select>

  <select id="findPageByCode" resultMap="BoardMap">
    SELECT id, code, title, content, writer, views, is_notice, created_at, updated_at
    FROM board_post
    WHERE code = #{code}
    ORDER BY is_notice DESC, id DESC
    LIMIT #{limit} OFFSET #{offset}
  </select>

  <select id="findOne" resultMap="BoardMap">
    SELECT id, code, title, content, writer, views, is_notice, created_at, updated_at
    FROM board_post WHERE id = #{id}
  </select>

  <insert id="insertPost" parameterType="spr.com.hallyu.board.model.BoardPost" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO board_post (code, title, content, writer, is_notice)
    VALUES (#{code}, #{title}, #{content}, #{writer}, #{isNotice})
  </insert>

  <update id="updatePost" parameterType="spr.com.hallyu.board.model.BoardPost">
    UPDATE board_post
    SET title = #{title}, content = #{content}, writer = #{writer}, is_notice = #{isNotice}
    WHERE id = #{id}
  </update>

  <delete id="deletePost" parameterType="long">
    DELETE FROM board_post WHERE id = #{id}
  </delete>

  <update id="increaseViews">
    UPDATE board_post SET views = views + 1 WHERE id = #{id}
  </update>

</mapper>
